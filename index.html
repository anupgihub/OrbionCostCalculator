<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Orbion Cost Calculator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <main
      class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md"
      aria-labelledby="title"
    >
      <h1 id="title" class="text-2xl font-bold mb-4 text-center">
        Orbion Cost Calculator
      </h1>

      <!-- =====  FORM  ===== -->
      <form id="costForm" class="space-y-4" novalidate>
        <!-- Number of Users -->
        <div>
          <label
            for="numUsers"
            class="block text-sm font-medium text-gray-700"
            >Number of Users</label
          >
          <input
            type="number"
            id="numUsers"
            name="numUsers"
            min="1"
            value="100"
            required
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>

        <!-- Order Value (kept for future use / discount ladders) -->
        <div>
          <label
            for="order"
            class="block text-sm font-medium text-gray-700"
            >Order (from Configuration)</label
          >
          <input
            type="number"
            id="order"
            name="order"
            min="1"
            value="1"
            required
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>

        <!-- Package Selection -->
        <div>
          <label
            for="packageType"
            class="block text-sm font-medium text-gray-700"
            >Package</label
          >
          <select
            id="packageType"
            name="packageType"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="access">Orbion Access</option>
            <option value="accessGov">Orbion Access &amp; Governance</option>
          </select>
        </div>

        <!-- Analytics upgrade Checkbox -->
        <div class="flex items-center">
          <input
            type="checkbox"
            id="upgrade"
            name="upgrade"
            class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
          />
          <label for="upgrade" class="ml-2 text-sm text-gray-700"
            >Include <span class="italic">Analytics Editor</span> option</label
          >
        </div>

        <!-- Working‑Unit Service Requests -->
        <div>
          <label
            for="srUnits"
            class="block text-sm font-medium text-gray-700"
            >Complementary Service Requests – Total W.U. ordered</label
          >
          <input
            type="number"
            id="srUnits"
            name="srUnits"
            min="0"
            value="0"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          <p class="text-xs text-gray-500 mt-1">
            Standard pack price: <strong>€1 350.00 per W.U.</strong> (catalog).
          </p>
        </div>

        <!-- Submit -->
        <button
          type="submit"
          class="w-full bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          Generate Proposal
        </button>
      </form>

      <!-- =====  OUTPUT  ===== -->
      <section id="result" class="mt-6 p-4 bg-gray-50 rounded-md hidden">
        <h2 class="text-lg font-semibold mb-2">
          Proposal for Orbion Subscription
        </h2>
        <hr class="mb-2" />
        <p id="packageText" class="text-gray-700"></p>
        <p id="usersText" class="text-gray-700"></p>

        <p class="font-semibold mt-4">Pricing Breakdown:</p>
        <ul id="breakdownText" class="list-disc list-inside text-gray-700"></ul>

        <p id="costText" class="text-gray-700 font-semibold mt-4"></p>

        <p class="font-semibold mt-4">Package Features:</p>
        <ul id="featuresText" class="list-disc list-inside text-gray-700"></ul>

        <p class="font-semibold mt-4">Notes:</p>
        <ul id="notesText" class="list-disc list-inside text-gray-700"></ul>
      </section>
    </main>

    <!-- =====  SCRIPT  ===== -->
    <script>
      // =============================
      //  DOM helpers
      // =============================
      const $ = (id) => document.getElementById(id);

      // =============================
      //  PRICE CATALOG  (EUR, excl. tax)
      //  Mirrors January‑2025 Evidian SaaS catalog
      // =============================
      const PRICE = {
        // Base subscriptions (€/user/month)
        access: { base: 6.0, analytics: 0.6 },
        accessGov: { base: 25.26, analytics: 1.78 },
        // Complementary services – Working‑Unit (€/WU)
        srWU: 1350.0, // SKU WUSSRO0‑0010 starter pack
      };

      // =============================
      //  FEATURE SETS  (for display only)
      // =============================
      const FEATURES = {
        access: ["Single Sign‑On (SSO)", "Multi‑Factor Authentication (MFA)"],
        accessGov: [
          "Single Sign‑On (SSO)",
          "Multi‑Factor Authentication (MFA)",
          "Identity Governance & Administration (IGA)",
          "Privileged Access Management (PAM)",
        ],
        analytics: ["Analytics Editor option"],
        srPack: ["Complementary service request pack (WU)"]
      };

      // =============================
      //  Calculation engine
      // =============================
      function calculate({ users, pkg, hasUpgrade, srUnits }) {
        const unitBase = PRICE[pkg].base;
        const unitAnalytics = hasUpgrade ? PRICE[pkg].analytics : 0;

        const baseCost = users * unitBase;
        const upgradeCost = users * unitAnalytics;
        const srCost = srUnits * PRICE.srWU; // one‑off cost (not per user)

        const totalMonthly = baseCost + upgradeCost;
        const totalYearly = totalMonthly * 12 + srCost; // workbook summarises yearly + SR

        return { baseCost, upgradeCost, srCost, totalMonthly, totalYearly };
      }

      // Currency helper – centralises formatting
      const formatter = new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: "EUR",
        minimumFractionDigits: 2,
      });
      const currency = (n) => formatter.format(n);

      // =============================
      //  UI renderer
      // =============================
      function render({ users, pkg, hasUpgrade, srUnits, costs }) {
        // Selected package
        $("packageText").textContent = `Selected Package: ${
          pkg === "access" ? "Orbion Access" : "Orbion Access & Governance"
        }${hasUpgrade ? " + Analytics Editor" : ""}`;
        // Users
        $("usersText").textContent = `Number of Users: ${users}`;

        // Pricing breakdown list
        const breakdown = [];
        breakdown.push(
          `${currency(PRICE[pkg].base)}/user/mo × ${users} users = ${currency(
            costs.baseCost
          )}`
        );
        if (hasUpgrade) {
          breakdown.push(
            `${currency(PRICE[pkg].analytics)}/user/mo upgrade × ${users} users = ${currency(
              costs.upgradeCost
            )}`
          );
        }
        if (srUnits > 0) {
          breakdown.push(
            `${currency(PRICE.srWU)} per W.U. × ${srUnits} W.U. = ${currency(
              costs.srCost
            )} (one‑off)`
          );
        }
        $("breakdownText").innerHTML = breakdown
          .map((li) => `<li>${li}</li>`) // safe simple HTML
          .join("");

        // Totals
        $("costText").innerHTML = `<strong>Total Cost:</strong> ${currency(
          costs.totalMonthly
        )} / month &nbsp;|&nbsp; ${currency(costs.totalYearly)} for first year`;

        // Feature list
        const featureSet = [
          ...FEATURES[pkg],
          ...(hasUpgrade ? FEATURES.analytics : []),
          ...(srUnits > 0 ? FEATURES.srPack : []),
        ];
        $("featuresText").innerHTML = featureSet
          .map((f) => `<li>${f}</li>`) // list items
          .join("");

        // Notes
        const notes = [
          "All prices shown are in EUR, excluding taxes.",
          "Subscription billed monthly, in advance.",
          "Complementary service‑request packs invoiced upon delivery.",
          "Standard business‑hours support included.",
        ];
        $("notesText").innerHTML = notes.map((n) => `<li>${n}</li>`).join("");

        // Reveal the panel
        $("result").classList.remove("hidden");
      }

      // =============================
      //  Event wiring
      // =============================
      document.addEventListener("DOMContentLoaded", () => {
        const form = $("costForm");

        // Calculate on submit
        form.addEventListener("submit", (e) => {
          e.preventDefault();

          const users = +$("numUsers").value;
          const orderVal = +$("order").value; // placeholder – future discount logic
          const pkg = $("packageType").value;
          const hasUpgrade = $("upgrade").checked;
          const srUnits = +$("srUnits").value || 0;

          // Minimal validation
          if (!users || users < 1) {
            alert("Please enter a positive number of users.");
            return;
          }
          if (!orderVal) {
            alert("Please enter a valid order number.");
            return;
          }
          if (srUnits < 0) {
            alert("Working‑unit count cannot be negative.");
            return;
          }

          const costs = calculate({ users, pkg, hasUpgrade, srUnits });
          render({ users, pkg, hasUpgrade, srUnits, costs });
        });
      });
    </script>
  </body>
</html>
